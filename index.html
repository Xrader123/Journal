<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Enhanced Trade Journal</title>
    <link rel="stylesheet" href="style.css" />
    <!-- External libraries -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isoWeek.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Account Balance Header -->
    <div class="account-header">
      <div class="container">
        <div class="account-balance-display">
          <span class="balance-label">Account Balance:</span>
          <span id="current-balance" class="balance-value">$0.00</span>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="trades">Trades</button>
      <button class="nav-tab" data-tab="dashboard">Dashboard</button>
      <button class="nav-tab" data-tab="money-management">Money</button>
      <button class="nav-tab" data-tab="templates">Templates</button>
      <button class="nav-tab" data-tab="settings">Settings</button>
      <button class="nav-tab" data-tab="import-export">Export</button>
    </nav>

    <main class="container">
      <!-- Trades Tab -->
      <section id="trades-tab" class="tab-content active">
        <div class="header-controls">
          <h1 class="title">Trades</h1>
          <div class="search-container">
            <input type="text" id="search-input" class="form-control" placeholder="Search trades..." />
          </div>
        </div>

        <div class="filters-section">
          <div class="filters flex flex-wrap gap-8 mb-8 items-center">
            <button id="filter-week" class="btn btn--secondary btn--sm">This Week</button>
            <button id="filter-month" class="btn btn--secondary btn--sm">This Month</button>
            <input type="date" id="filter-start" class="form-control" aria-label="Start date" />
            <input type="date" id="filter-end" class="form-control" aria-label="End date" />
            <button id="filter-apply" class="btn btn--outline btn--sm">Apply</button>
            <select id="filter-status" class="form-control">
              <option value="">All Status</option>
              <option value="open">Open</option>
              <option value="closed">Closed</option>
            </select>
          </div>
          <div class="advanced-filters hidden">
            <select id="filter-setup" class="form-control">
              <option value="">All Setups</option>
            </select>
            <select id="filter-sentiment" class="form-control">
              <option value="">All Sentiments</option>
              <option value="1">⭐</option>
              <option value="2">⭐⭐</option>
              <option value="3">⭐⭐⭐</option>
              <option value="4">⭐⭐⭐⭐</option>
              <option value="5">⭐⭐⭐⭐⭐</option>
            </select>
          </div>
          <button id="toggle-advanced-filters" class="btn btn--outline btn--sm">Show Filters</button>
          <span id="aggregate-pl" class="status ml-auto"></span>
        </div>

        <!-- Trade List View -->
        <div id="trade-list-view">
          <div class="table-responsive">
            <table id="trade-table" class="trade-table">
              <thead>
                <tr>
                  <th data-sort="symbol">Symbol</th>
                  <th data-sort="setup">Setup</th>
                  <th data-sort="status">Status</th>
                  <th>Sentiment</th>
                  <th data-sort="pl">Net P/L</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Trade Detail View -->
        <div id="trade-detail-view" class="hidden"></div>
      </section>

      <!-- Dashboard Tab -->
      <section id="dashboard-tab" class="tab-content hidden">
        <h1 class="title">Dashboard</h1>
        
        <!-- Account Overview -->
        <div class="account-overview">
          <div class="metric-card account-summary">
            <h3>Account Summary</h3>
            <div class="account-metrics">
              <div class="account-metric">
                <span class="label">Current Balance:</span>
                <span id="dashboard-balance" class="value">$0.00</span>
              </div>
              <div class="account-metric">
                <span class="label">Total Deposits:</span>
                <span id="total-deposits" class="value">$0.00</span>
              </div>
              <div class="account-metric">
                <span class="label">Total Withdrawals:</span>
                <span id="total-withdrawals" class="value">$0.00</span>
              </div>
              <div class="account-metric">
                <span class="label">Trading P/L:</span>
                <span id="trading-pl" class="value">$0.00</span>
              </div>
              <div class="account-metric">
                <span class="label">Trading Return:</span>
                <span id="trading-return" class="value">0.00%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="dashboard-metrics">
          <div class="metric-card">
            <h3>Win Rate</h3>
            <div class="metric-value" id="win-rate">0%</div>
          </div>
          <div class="metric-card">
            <h3>Risk-Reward Ratio</h3>
            <div class="metric-value" id="risk-reward">0.00</div>
          </div>
          <div class="metric-card">
            <h3>Total P/L</h3>
            <div class="metric-value" id="total-pl">$0.00</div>
          </div>
          <div class="metric-card">
            <h3>Average P/L</h3>
            <div class="metric-value" id="avg-pl">$0.00</div>
          </div>
          <div class="metric-card">
            <h3>Expectancy Ratio</h3>
            <div class="metric-value" id="expectancy">0.00</div>
          </div>
          <div class="metric-card">
            <h3>Max Drawdown</h3>
            <div class="metric-value" id="max-drawdown">$0.00</div>
          </div>
          <div class="metric-card">
            <h3>Profit Factor</h3>
            <div class="metric-value" id="profit-factor">0.00</div>
          </div>
          <div class="metric-card">
            <h3>Avg Days in Trade</h3>
            <div class="metric-value" id="avg-days">0</div>
          </div>
        </div>
        
        <div class="dashboard-charts">
          <div class="chart-container">
            <h3>Account Balance History</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="balance-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3>Cumulative Trading P/L</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="cumulative-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3>Money Flow Analysis</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="money-flow-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3>Win/Loss Distribution</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="winloss-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3>P/L by Symbol</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="symbol-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3>P/L by Setup</h3>
            <div style="position: relative; height: 300px;">
              <canvas id="setup-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Money Management Tab -->
      <section id="money-management-tab" class="tab-content hidden">
        <div class="header-controls">
          <h1 class="title">Money Management</h1>
          <div class="money-actions">
            <button id="add-deposit-btn" class="btn btn--primary btn--sm">+ Deposit</button>
            <button id="add-withdrawal-btn" class="btn btn--outline btn--sm">- Withdrawal</button>
          </div>
        </div>

        <div class="money-summary">
          <div class="summary-cards">
            <div class="metric-card">
              <h3>Net Funding</h3>
              <div class="metric-value" id="net-funding">$0.00</div>
            </div>
            <div class="metric-card">
              <h3>Total Deposits</h3>
              <div class="metric-value" id="summary-deposits">$0.00</div>
            </div>
            <div class="metric-card">
              <h3>Total Withdrawals</h3>
              <div class="metric-value" id="summary-withdrawals">$0.00</div>
            </div>
          </div>
        </div>

        <div class="money-list">
          <div class="table-responsive">
            <table id="money-table" class="trade-table">
              <thead>
                <tr>
                  <th data-sort="date">Date</th>
                  <th data-sort="type">Type</th>
                  <th data-sort="amount">Amount</th>
                  <th>Description</th>
                  <th>Running Balance</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Templates Tab -->
      <section id="templates-tab" class="tab-content hidden">
        <div class="header-controls">
          <h1 class="title">Trade Templates</h1>
          <button id="new-template-btn" class="btn btn--primary">+ New Template</button>
        </div>
        <div id="templates-list" class="templates-grid"></div>
      </section>

      <!-- Settings Tab -->
      <section id="settings-tab" class="tab-content hidden">
        <h1 class="title">Settings</h1>
        <div class="settings-section">
          <div class="form-group">
            <label class="form-label" for="theme-select">Theme</label>
            <select id="theme-select" class="form-control">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="blue">Ocean Blue</option>
              <option value="green">Forest Green</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="initial-balance">Initial Account Balance ($)</label>
            <input type="number" id="initial-balance" class="form-control" step="0.01" />
          </div>
          <div class="form-group">
            <label class="form-label" for="default-risk">Default Risk (%)</label>
            <input type="number" id="default-risk" class="form-control" step="0.1" min="0" max="100" />
          </div>
          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="auto-save" /> Auto-save changes
            </label>
          </div>
          <button id="clear-data-btn" class="btn btn--error">Clear All Data</button>
        </div>
      </section>

      <!-- Import/Export Tab -->
      <section id="import-export-tab" class="tab-content hidden">
        <h1 class="title">Import/Export</h1>
        <div class="import-export-section">
          <div class="card">
            <div class="card__body">
              <h3>Export Data</h3>
              <p>Export your trading data in organized format with account summary, money management, and trade details.</p>
              <div class="flex gap-8">
                <button id="export-csv-btn" class="btn btn--primary">Export Organized CSV</button>
                <button id="export-json-btn" class="btn btn--secondary">Export JSON Backup</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card__body">
              <h3>Import Data</h3>
              <div class="form-group">
                <label class="form-label" for="import-file">Select JSON backup file</label>
                <input type="file" id="import-file" class="form-control" accept=".json" />
              </div>
              <button id="import-btn" class="btn btn--primary">Import Data</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Floating action button -->
    <button id="new-trade-btn" class="fab btn btn--primary" aria-label="Add Trade">+</button>

    <!-- Position Size Calculator -->
    <div id="pos-calc-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2>Position Size Calculator</h2>
        <div class="pos-calc-form">
          <div class="form-group">
            <label class="form-label">Account Balance</label>
            <input type="number" id="calc-balance" class="form-control" step="0.01" readonly />
          </div>
          <div class="form-group">
            <label class="form-label">Risk % per Trade</label>
            <input type="number" id="calc-risk" class="form-control" step="0.1" />
          </div>
          <div class="form-group">
            <label class="form-label">Entry Price</label>
            <input type="number" id="calc-entry" class="form-control" step="0.01" />
          </div>
          <div class="form-group">
            <label class="form-label">Stop Loss Price</label>
            <input type="number" id="calc-stop" class="form-control" step="0.01" />
          </div>
          <div class="calc-result">
            <strong>Suggested Position Size: <span id="calc-result">0</span> shares</strong>
          </div>
          <div class="flex gap-8 justify-end mt-8">
            <button type="button" class="btn btn--secondary" data-close-modal>Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Trade Modal -->
    <div id="trade-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2 id="trade-modal-title">New Trade</h2>
        <form id="trade-form" class="flex flex-col gap-16 mt-8" autocomplete="off">
          <div class="form-group">
            <label class="form-label" for="trade-template">Use Template (Optional)</label>
            <select id="trade-template" class="form-control">
              <option value="">-- Select Template --</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="trade-symbol">Symbol</label>
            <input type="text" id="trade-symbol" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="trade-setup">Setup</label>
            <input type="text" id="trade-setup" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="trade-before">Before Entry Notes</label>
            <textarea id="trade-before" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="trade-sentiment">Sentiment</label>
            <select id="trade-sentiment" class="form-control" required>
              <option value="1">⭐ (1 - Very Bearish)</option>
              <option value="2">⭐⭐ (2 - Bearish)</option>
              <option value="3">⭐⭐⭐ (3 - Neutral)</option>
              <option value="4">⭐⭐⭐⭐ (4 - Bullish)</option>
              <option value="5">⭐⭐⭐⭐⭐ (5 - Very Bullish)</option>
            </select>
          </div>
          <div class="flex gap-8">
            <button type="button" id="pos-calc-btn" class="btn btn--outline">Position Calculator</button>
          </div>
          <div class="flex gap-8 justify-end">
            <button type="button" class="btn btn--secondary" data-close-modal>Cancel</button>
            <button type="submit" class="btn btn--primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Money Entry Modal -->
    <div id="money-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2 id="money-modal-title">Add Money Entry</h2>
        <form id="money-form" class="flex flex-col gap-16 mt-8" autocomplete="off">
          <div class="form-group">
            <label class="form-label" for="money-date">Date</label>
            <input type="date" id="money-date" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="money-type">Type</label>
            <select id="money-type" class="form-control" required>
              <option value="Deposit">Deposit</option>
              <option value="Withdrawal">Withdrawal</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="money-amount">Amount ($)</label>
            <input type="number" id="money-amount" class="form-control" step="0.01" required min="0" />
          </div>
          <div class="form-group">
            <label class="form-label" for="money-description">Description</label>
            <input type="text" id="money-description" class="form-control" placeholder="Brief description..." />
          </div>
          <div class="flex gap-8 justify-end">
            <button type="button" class="btn btn--secondary" data-close-modal>Cancel</button>
            <button type="submit" class="btn btn--primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Template Modal -->
    <div id="template-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2 id="template-modal-title">New Template</h2>
        <form id="template-form" class="flex flex-col gap-16 mt-8" autocomplete="off">
          <div class="form-group">
            <label class="form-label" for="template-name">Template Name</label>
            <input type="text" id="template-name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="template-setup">Setup</label>
            <input type="text" id="template-setup" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="template-before">Before Entry Notes</label>
            <textarea id="template-before" class="form-control" rows="3"></textarea>
          </div>
          <div class="flex gap-8 justify-end">
            <button type="button" class="btn btn--secondary" data-close-modal>Cancel</button>
            <button type="submit" class="btn btn--primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Decision Modal -->
    <div id="decision-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2 id="decision-modal-title">Add Decision</h2>
        <form id="decision-form" class="flex flex-col gap-16 mt-8" autocomplete="off">
          <div class="form-group">
            <label class="form-label" for="decision-label">Label</label>
            <input type="text" id="decision-label" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="decision-date">Date</label>
            <input type="date" id="decision-date" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="decision-price">Price</label>
            <input type="number" step="0.01" id="decision-price" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="decision-qty">Quantity (buy +, sell -)</label>
            <input type="number" id="decision-qty" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="decision-type">Type</label>
            <select id="decision-type" class="form-control" required>
              <option value="entry">Entry</option>
              <option value="exit">Exit</option>
              <option value="partial">Partial</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="decision-comments">Comments</label>
            <textarea id="decision-comments" class="form-control" rows="2"></textarea>
          </div>
          <div class="flex gap-8 justify-end">
            <button type="button" class="btn btn--secondary" data-close-modal>Cancel</button>
            <button type="submit" class="btn btn--primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal__content">
        <h2 id="confirm-title">Confirm Action</h2>
        <p id="confirm-message"></p>
        <div class="flex gap-8 justify-end mt-8">
          <button type="button" class="btn btn--secondary" data-close-modal>Cancel</button>
          <button type="button" id="confirm-action" class="btn btn--error">Confirm</button>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>